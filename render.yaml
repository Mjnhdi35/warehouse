services:
  - type: web
    name: warehouse-api
    runtime: node
    plan: free
    rootDir: .
    envVars:
      - key: NODE_ENV
        value: production
    healthCheckPath: /
    buildCommand: >
      node .yarn/releases/yarn-4.10.3.cjs install --immutable &&
      node .yarn/releases/yarn-4.10.3.cjs --cwd apps/api build
    startCommand: NODE_ENV=production NODE_OPTIONS=--max-old-space-size=384 node apps/api/dist/main.js

  - type: web
    name: warehouse-web
    runtime: node
    plan: free
    rootDir: .
    envVars:
      - key: NODE_ENV
        value: production
    healthCheckPath: /
    buildCommand: >
      node .yarn/releases/yarn-4.10.3.cjs install --immutable &&
      node .yarn/releases/yarn-4.10.3.cjs nx build web
    startCommand: NODE_ENV=production NODE_OPTIONS=--max-old-space-size=384 node apps/web/.output/server/index.mjs
