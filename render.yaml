services:
  - type: web
    name: warehouse-api
    runtime: node
    plan: free
    rootDir: .
    envVars:
      - key: NODE_ENV
        value: production
    healthCheckPath: /
    buildCommand: |
      corepack enable || true
      corepack prepare yarn@4.10.3 --activate || true
      yarn install --immutable
      yarn --cwd apps/api build
    startCommand: yarn --cwd apps/api start:prod

  - type: web
    name: warehouse-web
    runtime: node
    plan: free
    rootDir: .
    envVars:
      - key: NODE_ENV
        value: production
    healthCheckPath: /
    buildCommand: |
      corepack enable || true
      corepack prepare yarn@4.10.3 --activate || true
      yarn install --immutable
      yarn --cwd apps/web build
    startCommand: yarn --cwd apps/web start
